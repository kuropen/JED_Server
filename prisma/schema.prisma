// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

enum PeakType {
  AMOUNT
  PERCENTAGE
}

model Area {
  id             Int     @id @default(autoincrement())
  code           String  @unique
  name           String
  longName       String
  officialWeb    String
  csvFile        String
  csvHourlyPos   Int     @default(14)
  csvFiveMinPos  Int     @default(55)
  hasWindData    Boolean @default(false)
  peak           PeakElectricity[]
  hourly         HourlyDemand[]
  fivemin        FiveMinDemand[]
}

model PeakElectricity {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  area         Area     @relation(fields: [areaId], references: [id])
  areaId       Int
  date         DateTime @db.Date
  expectedHour String
  type         PeakType
  amount       Int
  supply       Int
  percentage   Int
  reservePct   Int?
  isTomorrow   Boolean  @default(false)

  @@unique([areaId, type, date])
}

model HourlyDemand {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  area         Area     @relation(fields: [areaId], references: [id])
  areaId       Int
  date         DateTime @db.Date
  hour         Int
  absTime      DateTime?
  amount       Int
  supply       Int
  percentage   Int

  @@unique([areaId, date, hour])
  @@index([areaId, date])
}

model FiveMinDemand {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  area         Area     @relation(fields: [areaId], references: [id])
  areaId       Int
  date         DateTime @db.Date
  time         String
  absTime      DateTime?
  amount       Int
  solar        Int?
  wind         Int?

  @@unique([areaId, date, time])
  @@index([areaId, date])
}
